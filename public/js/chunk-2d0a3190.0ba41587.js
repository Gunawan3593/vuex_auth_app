(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0a3190"],{"0170":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",{attrs:{align:"center",justify:"center"}},[r("v-col",{attrs:{cols:"12",sm:"8",md:"12"}},[r("v-card",{staticClass:"elevation-12"},[r("v-toolbar",{attrs:{color:"primary",dark:"",flat:""}},[r("v-toolbar-title",[t._v("Add Sales Delivery")]),r("v-spacer"),r("v-toolbar-title",[r("v-tooltip",{attrs:{left:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,s=e.attrs;return[r("v-btn",t._g(t._b({attrs:{icon:"",color:"dee-orange"},on:{click:function(e){return t.Back()}}},"v-btn",s,!1),a),[r("v-icon",[t._v("mdi-arrow-left-bold")])],1)]}}])},[r("span",[t._v("Back to List")])]),r("v-tooltip",{attrs:{left:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,s=e.attrs;return[r("v-btn",t._g(t._b({attrs:{icon:"",color:"dee-orange",link:"",to:"/purchase/delivery/add"}},"v-btn",s,!1),a),[r("v-icon",[t._v("mdi-restore")])],1)]}}])},[r("span",[t._v("New Data")])]),r("v-tooltip",{attrs:{left:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,s=e.attrs;return[r("v-btn",t._g(t._b({attrs:{icon:"",color:"dee-orange",loading:t.isLoading},on:{click:t.submit}},"v-btn",s,!1),a),[r("v-icon",[t._v("mdi-content-save-move-outline")])],1)]}}])},[r("span",[t._v("Save Data")])])],1)],1),r("v-card-text",[r("v-form",[r("v-row",[r("v-col",{attrs:{cols:"12",sm:"12",md:"4"}},[r("v-text-field",{attrs:{label:"No.","prepend-icon":"mdi-numeric",type:"text",readonly:""},model:{value:t.fields.no,callback:function(e){t.$set(t.fields,"no",e)},expression:"fields.no"}})],1),r("v-col",{attrs:{cols:"12",sm:"12",md:"4"}},[r("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[r("v-text-field",t._g({attrs:{label:"Date","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},a))]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[r("v-date-picker",{on:{input:function(e){t.menu=!1}},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)],1),r("v-col",{attrs:{cols:"12",sm:"12",md:"4"}},[r("v-autocomplete",{attrs:{"error-messages":t.customerErrors,required:"",items:t.customerItems,"hide-no-data":"","hide-selected":"","item-text":"Description","item-value":"_id",label:"Customer",placeholder:"Start typing to Search","prepend-icon":"mdi-dresser","return-object":!1},on:{change:function(e){return t.loadOrder(e)},input:function(e){return t.$v.fields.customer.$touch()},blur:function(e){return t.$v.fields.customer.$touch()}},model:{value:t.fields.customer,callback:function(e){t.$set(t.fields,"customer",e)},expression:"fields.customer"}})],1)],1)],1),r("v-row",[r("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[r("v-autocomplete",{attrs:{"error-messages":t.orderErrors,required:"",items:t.orderItems,"hide-no-data":"","hide-selected":"","item-text":"Description","item-value":"_id",label:"Order",placeholder:"Start typing to Search","prepend-icon":"mdi-cart-outline","return-object":!1},on:{change:function(e){return t.getOrderItem(e)},input:function(e){return t.$v.fields.order.$touch()},blur:function(e){return t.$v.fields.order.$touch()}},model:{value:t.fields.order,callback:function(e){t.$set(t.fields,"order",e)},expression:"fields.order"}})],1),r("v-col",{attrs:{cols:"12",sm:"6",md:"8"}},[r("p",{staticClass:"display-2 text-right",staticStyle:{"padding-right":"10px"}},[t._v("Total : "+t._s(t._f("currency")(t.getSubtotal)))])])],1),r("v-row",[r("v-col",{attrs:{cols:"12",sm:"12",md:"12"}},[r("v-simple-table",{attrs:{dense:""},scopedSlots:t._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",{staticClass:"text-center"},[t._v("Name")]),r("th",{staticClass:"text-center",attrs:{width:"100px"}},[t._v("Order")]),r("th",{staticClass:"text-center",attrs:{width:"100px"}},[t._v("Stock")]),r("th",{staticClass:"text-center",attrs:{width:"100px"}},[t._v("Qty")]),r("th",{staticClass:"text-center",attrs:{width:"200px;"}},[t._v("Cost")]),r("th",{staticClass:"text-center",attrs:{width:"200px;"}},[t._v("Total")])])]),r("tbody",t._l(t.fields.items,(function(e,a){return r("tr",{key:e.product},[r("td",[t._v(t._s(e.name))]),r("td",[t._v(t._s(e.order_qty))]),r("td",[t._v(t._s(e.stock)+" "),r("v-tooltip",{attrs:{left:"",color:"error"},scopedSlots:t._u([{key:"activator",fn:function(a){var s=a.on,n=a.attrs;return[e.stock<e.qty?r("v-icon",t._g(t._b({attrs:{color:"error"}},"v-icon",n,!1),s),[t._v("mdi-alert-circle")]):t._e()]}}],null,!0)},[r("span",[t._v("Warning : Stock is not enough !"),r("br"),t._v(" If you still save the delivery, "),r("br"),t._v(" Stock will have minus value")])])],1),r("td",[r("v-currency-field",{attrs:{"decimal-length":0,"place-holder":"Qty"},on:{change:function(e){return t.checkQty(a)}},model:{value:e.qty,callback:function(r){t.$set(e,"qty",r)},expression:"item.qty"}})],1),r("td",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(e.cost)))]),r("td",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(e.qty*e.cost)))])])})),0)]},proxy:!0}])})],1)],1),r("v-row",[r("v-col",{attrs:{cols:"12",md:"6"}},[r("v-textarea",{attrs:{"prepend-icon":"mdi-note-text-outline",label:"Notes",value:"fields.notes",rows:"3"},model:{value:t.fields.notes,callback:function(e){t.$set(t.fields,"notes",e)},expression:"fields.notes"}})],1)],1)],1)],1)],1)],1)},s=[],n=(r("4160"),r("d81d"),r("fb6a"),r("b0c0"),r("d3b7"),r("25f0"),r("159b"),r("96cf"),r("1da1")),o=r("5530"),i=r("1dce"),c=r("b5ae"),d=r("2f62"),u={mixins:[i["validationMixin"]],validations:{fields:{customer:{required:c["required"]},order:{required:c["required"]}}},computed:Object(o["a"])(Object(o["a"])({},Object(d["c"])(["user","purchaseOrderStatus"])),{},{customerErrors:function(){var t=[];return this.$v.fields.customer.$dirty?(!this.$v.fields.customer.required&&t.push("Customer is required."),t):t},orderErrors:function(){var t=[];return this.$v.fields.order.$dirty?(!this.$v.fields.order.required&&t.push("Order is required."),t):t},customerItems:function(){return this.customers.map((function(t){var e=t.name;return Object.assign({},t,{Description:e})}))},orderItems:function(){return this.orders.map((function(t){var e=t.no;return Object.assign({},t,{Description:e})}))},getSubtotal:function(){var t=this.fields.items;if(0!=t.length){for(var e=0,r=0;r<t.length;r++)e+=t[r].qty*t[r].cost;return e}}}),data:function(){return{fields:{id:!1,no:"",transdate:"",order:"",customer:"",notes:"",user:"",items:[]},date:"",customers:[],orders:[],products:[],isLoading:!1,menu:!1,page:""}},mounted:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getCustomer();case 2:r=e.sent,a=r.data.data,a&&(t.customers=a),s=t.$route.params.id,void 0!=s?t.loadData(s):t.reset();case 7:case"end":return e.stop()}}),e)})))()},created:function(){var t=this.$route.query.page;this.page=t},methods:Object(o["a"])(Object(o["a"])({},Object(d["b"])(["getSdNo","getCustomer","addSalesDelivery","getSoItem","getSdItem","updateSalesDelivery","getSalesDelivery","getSoDelivable","checkStock"])),{},{getDateTime:function(t){var e=new Date(t),r=(new Date).getHours().toString(),a=(new Date).getMinutes().toString(),s=(new Date).getSeconds().toString(),n=("00"+r).substring(r.length)+":"+("00"+a).substring(a.length)+":"+("00"+s).substring(s.length);return e.toISOString().slice(0,10)+" "+n},loadData:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.getSalesDelivery(t);case 2:if(a=r.sent,void 0!=a){r.next=5;break}return r.abrupt("return",e.$router.push({name:"sdlist"}));case 5:s=a.data.data,e.fields.id=t,e.fields.no=s.no,e.orders.push(s.order),e.fields.order=s.order._id,e.fields.notes=s.notes,e.fields.user=e.user._id,e.fields.customer=s.customer._id,e.fields.transdate=s.transdate,e.date=s.transdate.slice(0,10),e.getItem(t);case 16:case"end":return r.stop()}}),r)})))()},loadOrder:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.getSoDelivable(t);case 2:a=r.sent,s=a.data.data,e.orders=[],e.fields.items=[],void 0!=s&&s.forEach((function(t){e.orders.push(t)}));case 7:case"end":return r.stop()}}),r)})))()},addData:function(){var t=this;this.isloading=!0,this.addSalesDelivery(this.fields).then((function(e){e.data.success&&(t.isloading=!1,t.$router.push("/sales/delivery/list"))}))},updateData:function(){var t=this;this.isloading=!0,this.updateSalesDelivery(this.fields).then((function(e){e.data.success&&(t.isloading=!1,t.$router.push({name:"sdlist",params:{page:t.page}}))}))},reset:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getSdNo();case 2:r=e.sent,t.fields.id=!1,t.fields.no=r.data.code,t.date=(new Date).toISOString().slice(0,10),t.fields.customer="",t.fields.notes="",t.fields.items=[],t.fields.user=t.user._id,t.fields.transdate=new Date;case 11:case"end":return e.stop()}}),e)})))()},getItem:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a={delivery:t},r.next=3,e.getSdItem(a).then((function(t){if(t.data.success){var r=t.data.data;e.fields.items=[],r.forEach((function(t){t={name:t.product.name,order_item:t.order_item._id,product:t.product._id,cost:t.cost,order_qty:t.qty+(t.order_item.qty-t.order_item.deliv_qty),qty:t.qty,stock:t.qty},e.fields.items.push(t)}))}}));case 3:s=e.fields.items,s.forEach((function(t){e.checkStock(t.product).then((function(e){var r=e.data.qty;t.stock+=r}))}));case 5:case"end":return r.stop()}}),r)})))()},getOrderItem:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a={order:t},r.next=3,e.getSoItem(a).then((function(t){if(t.data.success){var r=t.data.data;e.fields.items=[],r.forEach((function(t){t.qty-t.deliv_qty>0&&(t={name:t.product.name,order_item:t._id,product:t.product._id,cost:t.cost,order_qty:t.qty-t.deliv_qty,qty:t.qty-t.deliv_qty,stock:0},e.fields.items.push(t))}))}}));case 3:s=e.fields.items,s.forEach((function(t){e.checkStock(t.product).then((function(e){var r=e.data.qty;t.stock=r}))}));case 5:case"end":return r.stop()}}),r)})))()},Back:function(){this.$router.push({name:"sdlist",params:{page:this.page}})},checkQty:function(t){var e=this.fields.items[t];e.qty>e.order_qty&&(e.qty=e.order_qty)},submit:function(){this.fields.transdate=this.getDateTime(this.date),this.$v.$touch(),this.$v.$error||(this.fields.id?this.updateData():this.addData())}})},l=u,f=r("2877"),v=r("6544"),m=r.n(v),p=r("c6a6"),h=r("8336"),g=r("b0af"),b=r("99d9"),_=r("62ad"),y=r("2e4b"),k=r("4bd4"),x=r("132d"),w=r("e449"),S=r("0fd9"),q=r("1f4f"),D=r("2fa4"),$=r("8654"),O=r("a844"),j=r("71d9"),C=r("2a7f"),V=r("3a2f"),I=Object(f["a"])(l,a,s,!1,null,null,null);e["default"]=I.exports;m()(I,{VAutocomplete:p["a"],VBtn:h["a"],VCard:g["a"],VCardText:b["b"],VCol:_["a"],VDatePicker:y["a"],VForm:k["a"],VIcon:x["a"],VMenu:w["a"],VRow:S["a"],VSimpleTable:q["a"],VSpacer:D["a"],VTextField:$["a"],VTextarea:O["a"],VToolbar:j["a"],VToolbarTitle:C["a"],VTooltip:V["a"]})}}]);
//# sourceMappingURL=chunk-2d0a3190.0ba41587.js.map